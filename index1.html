<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-Cell Store | Ø§Ù„Ø­ÙŠÙˆÙŠØ© ÙˆØ§Ù„ØªÙ…ÙŠØ²</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="contact-bar">
    <a href="tel:78961175"><i class="fas fa-phone"></i> 78961175</a>
    <a href="https://maps.app.goo.gl/EJoXedJGapY6u3jKA" target="_blank"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø§Ù„Ù…Ø´Ø±ÙÙŠØ©ØŒ Ø¨ÙŠØ±ÙˆØª</a>
</div>

<header class="main-header">
    <h1 class="brand-logo">O-<span>CELL</span></h1>
</header>

<div id="homeView">
    <div class="hero-vibrant">
        <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§</h2>
        <p>Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªÙŠ ØªØ«Ù‚ Ø¨Ù‡Ø§ØŒ Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ Ø§Ù„Ø¢Ù†</p>
        <div class="delivery-tag">ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙ„ÙŠÙÙŠØ±ÙŠ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù„Ø¨Ù†Ø§Ù†ÙŠØ© ğŸ‡±ğŸ‡§</div>
    </div>
    <div class="container">
        <h3 style="color: var(--dark-blue); margin-bottom: 25px; font-weight: 900;">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h3>
        <div class="grid" id="catGrid"></div>
    </div>
</div>

<div id="productView" class="hidden container">
    <div style="padding: 25px 0;">
        <button onclick="goBack()" style="background:var(--light-blue); border:none; color:var(--dark-blue); padding:10px 25px; border-radius:30px; cursor:pointer; font-weight:900;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</button>
    </div>
    <h2 id="catTitle" style="color: var(--dark-blue); text-align: center; margin-bottom: 35px; font-size: 2rem;"></h2>
    <div class="grid" id="prodGrid"></div>
</div>

<div id="modal" class="full-modal" onclick="if(event.target==this) goBack()">
    <div class="modal-box">
        <img id="mImg" src="">
        <h2 id="mTitle"></h2>
        <p id="mDesc"></p>
        <div id="mPrice" style="font-size: 32px; color: var(--dark-blue); font-weight: 900; margin-bottom: 20px;"></div>
        <div id="waAction"></div>
        <button onclick="goBack()" style="background:none; border:none; color:var(--gray-text); margin-top:20px; cursor:pointer; font-weight:700;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCnzm7b0mEiszDck9d_KvOfVMN2WguQs8w",
        authDomain: "o-cell-8bd7f.firebaseapp.com",
        projectId: "o-cell-8bd7f",
        storageBucket: "o-cell-8bd7f.firebasestorage.app",
        messagingSenderId: "123702658364",
        appId: "1:123702658364:web:f51ca179843af7bab24a39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const PHONE = "96178961175";

    // Navigation Logic
    window.addEventListener('popstate', (e) => {
        if (e.state && e.state.view === 'products') {
            renderProducts(e.state.name, false);
        } else {
            renderHome();
            closeM();
        }
    });

    async function loadResources() {
        const snap = await getDocs(collection(db, "categories"));
        const grid = document.getElementById('catGrid');
        snap.forEach(d => {
            const c = d.data();
            grid.innerHTML += `
                <div class="smart-card" onclick="openCategory('${c.name}')">
                    <img src="${c.image}">
                    <div class="content"><h3>${c.name}</h3></div>
                </div>`;
        });
    }

    window.openCategory = (n) => {
        history.pushState({view: 'products', name: n}, "");
        renderProducts(n);
    };

    function renderProducts(n) {
        document.getElementById('homeView').classList.add('hidden');
        document.getElementById('productView').classList.remove('hidden');
        document.getElementById('catTitle').innerText = n;
        fetchItems(n);
    }

    function renderHome() {
        document.getElementById('homeView').classList.remove('hidden');
        document.getElementById('productView').classList.add('hidden');
    }

    async function fetchItems(n) {
        const grid = document.getElementById('prodGrid');
        grid.innerHTML = "<p style='grid-column: 1/-1; text-align:center;'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø©...</p>";
        const snap = await getDocs(collection(db, "products"));
        grid.innerHTML = "";
        snap.forEach(d => {
            const p = d.data();
            if(p.category === n) {
                grid.innerHTML += `
                <div class="smart-card" onclick="openDetails('${p.name}','${p.image}','${p.description}','${p.price}', ${p.inStock})">
                    ${!p.inStock ? '<div class="status-label">Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>' : ''}
                    <img src="${p.image}">
                    <div class="content"><h3>${p.name}</h3><div class="price">$${p.price}</div></div>
                </div>`;
            }
        });
    }

    window.openDetails = (n, i, d, p, s) => {
        history.pushState({view: 'modal'}, "");
        document.getElementById('mImg').src = i;
        document.getElementById('mTitle').innerText = n;
        document.getElementById('mDesc').innerText = d;
        document.getElementById('mPrice').innerText = "$" + p;
        const link = `https://wa.me/${PHONE}?text=${encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹ O-CellØŒ Ø£ÙˆØ¯ Ø·Ù„Ø¨: '+n+' Ø¨Ø³Ø¹Ø± $'+p)}`;
        document.getElementById('waAction').innerHTML = s ? 
            `<a href="${link}" class="order-now-btn">Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± WhatsApp <i class="fab fa-whatsapp"></i></a>` : 
            `<div class="order-now-btn btn-out">ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
        document.getElementById('modal').style.display = "flex";
    };

    window.goBack = () => history.back();
    window.closeM = () => document.getElementById('modal').style.display = "none";

    loadResources();
</script>
</body>
</html>
