<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-Cell Professional Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a1a2e; --secondary: #16213e; --accent: #0f3460;
            --text: #e94560; --light: #ffffff; --success: #27ae60; --danger: #e74c3c;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; display: none; }
        
        /* Sidebar Design */
        .sidebar { width: 260px; background: var(--primary); color: white; height: 100vh; position: fixed; right: 0; top: 0; padding: 20px; box-sizing: border-box; }
        .sidebar h2 { color: var(--text); border-bottom: 2px solid var(--accent); padding-bottom: 10px; text-align: center; }
        .nav-item { padding: 15px; margin: 10px 0; cursor: pointer; border-radius: 8px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: var(--accent); }

        /* Main Content Area */
        .main { margin-right: 260px; padding: 30px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-right: 5px solid var(--text); }
        .stat-card h3 { font-size: 14px; color: #666; margin: 0; }
        .stat-card p { font-size: 28px; font-weight: bold; margin: 10px 0; color: var(--primary); }

        /* Form Design */
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 30px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { background: var(--text); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #c63951; }

        /* User Management Table */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; border-bottom: 1px solid #eee; text-align: right; }
        th { background: #f8f9fa; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .badge-business { background: #e3fcef; color: #27ae60; }
        .badge-user { background: #f0f2f5; color: #666; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>O-Cell Store</h2>
    <div class="nav-item"><i class="fas fa-box"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø·Ø¹</div>
    <div class="nav-item"><i class="fas fa-users"></i> Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† (B2B/B2C)</div>
    <div class="nav-item"><i class="fas fa-undo"></i> Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</div>
    <div class="nav-item"><i class="fas fa-clock"></i> Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>
    <button onclick="location.reload()" style="background:var(--danger); margin-top: 50px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="main">
    <div class="header">
        <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¹Ù„ÙŠ ğŸ‘‹</h1>
        <div id="currentDate"></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø·Ø¹</h3><p id="stTotal">0</p></div>
        <div class="stat-card"><h3>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Stock)</h3><p id="stStock">0</p></div>
        <div class="stat-card" style="border-right-color: var(--success)"><h3>Ø²Ø¨Ø§Ø¦Ù† Business</h3><p id="stBiz">0</p></div>
        <div class="stat-card" style="border-right-color: var(--warning)"><h3>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h3><p>0</p></div>
    </div>

    <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ (Ø¬Ù…Ù„Ø© ÙˆÙ…ÙØ±Ù‚)</h3>
        <div class="grid-inputs">
            <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="pQty" placeholder="Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ">
            <input type="number" id="pPriceRetail" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù…ÙØ±Ù‚ ($)">
            <input type="number" id="pPriceWholesale" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© ($)">
        </div>
        <select id="pCategory">
            <option value="phones">Ù‡ÙˆØ§ØªÙ</option>
            <option value="accessories">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</option>
            <option value="tools">Ø£Ø¯ÙˆØ§Øª Ø±Ø¨Ø·</option>
        </select>
        <input type="text" id="pImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (URL)">
        <button id="addBtn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
    </div>

    <div class="card">
        <h3><i class="fas fa-user-shield"></i> Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                    <th>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody id="userList">
                </tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCnzm7b0mEiszDck9d_KvOfVMN2WguQs8w",
        authDomain: "o-cell-8bd7f.firebaseapp.com",
        projectId: "o-cell-8bd7f",
        storageBucket: "o-cell-8bd7f.firebasestorage.app",
        messagingSenderId: "123702658364",
        appId: "1:123702658364:web:f51ca179843af7bab24a39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµØ§Ø±Ù…Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ ---
    const secureLogin = () => {
        let u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
        let p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        if(u === "ali" && p === "ali$2006") {
            document.body.style.display = "block";
            init();
        } else {
            alert("ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ!");
            window.location.href = "https://google.com";
        }
    }
    secureLogin();

    async function init() {
        loadStats();
        loadUsers();
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ar-LB');
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø³Ø¹Ø±ÙŠÙ†
    document.getElementById('addBtn').onclick = async () => {
        const product = {
            name: document.getElementById('pName').value,
            qty: Number(document.getElementById('pQty').value),
            priceRetail: Number(document.getElementById('pPriceRetail').value),
            priceWholesale: Number(document.getElementById('pPriceWholesale').value),
            category: document.getElementById('pCategory').value,
            image: document.getElementById('pImg').value,
            date: new Date()
        };
        await addDoc(collection(db, "products"), product);
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
        location.reload();
    };

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØºÙŠÙŠØ± Ø±ØªØ¨Ù‡Ù…
    async function loadUsers() {
        const snap = await getDocs(collection(db, "users"));
        const list = document.getElementById('userList');
        snap.forEach(d => {
            const u = d.data();
            list.innerHTML += `
                <tr>
                    <td>${u.email}</td>
                    <td><span class="badge ${u.role === 'business' ? 'badge-business' : 'badge-user'}">${u.role || 'Ø¹Ø§Ø¯ÙŠ'}</span></td>
                    <td><button onclick="toggleRole('${d.id}', '${u.role}')" style="padding:5px; font-size:12px;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†ÙˆØ¹</button></td>
                </tr>`;
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    async function loadStats() {
        const pSnap = await getDocs(collection(db, "products"));
        document.getElementById('stTotal').innerText = pSnap.size;
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù€ Stock Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙˆØ§Ù„Ø²Ø¨Ø§Ø¦Ù†
    }
</script>
</body>
</html>
