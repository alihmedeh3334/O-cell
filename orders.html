<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; padding: 20px; background: #fff; }
        .order-card { background: white; border-right: 5px solid #f39c12; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .order-info { flex-grow: 1; }
        .order-status { font-weight: bold; color: #f39c12; }
        .btn-done { background: #27ae60; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        .btn-return { background: #e74c3c; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-right: 5px; }
    </style>
</head>
<body>
    <h1>â³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (ØªØ­Øª Ø§Ù„ØªÙ†ÙÙŠØ°)</h1>
    <div id="orders-list"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCnzm7b0mEiszDck9d_KvOfVMN2WguQs8w",
        authDomain: "o-cell-8bd7f.firebaseapp.com",
        projectId: "o-cell-8bd7f",
        storageBucket: "o-cell-8bd7f.firebasestorage.app",
        messagingSenderId: "123702658364",
        appId: "1:123702658364:web:f51ca179843af7bab24a39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadOrders() {
        const snap = await getDocs(collection(db, "orders"));
        const list = document.getElementById('orders-list');
        list.innerHTML = "";
        
        if (snap.empty) { list.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return; }

        snap.forEach(d => {
            const o = d.data();
            list.innerHTML += `
                <div class="order-card">
                    <div class="order-info">
                        <strong>Ø§Ù„Ø²Ø¨ÙˆÙ†: ${o.userName}</strong> (Ù‡Ø§ØªÙ: ${o.userPhone})<br>
                        Ø§Ù„Ø·Ù„Ø¨: ${o.productName} - Ø§Ù„Ø³Ø¹Ø±: $${o.priceUsed}<br>
                        <small>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${o.date.toDate().toLocaleString('ar-LB')}</small>
                    </div>
                    <div>
                        <button class="btn-done" onclick="window.completeOrder('${d.id}')">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ âœ…</button>
                        <button class="btn-return" onclick="window.moveToReturns('${d.id}')">Ù…Ø±ØªØ¬Ø¹ ğŸ”„</button>
                    </div>
                </div>`;
        });
    }

    // ÙˆØ¸ÙŠÙØ© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ø­Ø°ÙÙ‡ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª)
    window.completeOrder = async (id) => {
        if(confirm("Ù‡Ù„ ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŸ")) {
            await deleteDoc(doc(db, "orders", id));
            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©.");
            loadOrders();
        }
    };

    // ÙˆØ¸ÙŠÙØ© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù…Ø±ØªØ¬Ø¹
    window.moveToReturns = async (id) => {
        const orderSnap = await getDocs(collection(db, "orders"));
        const orderData = orderSnap.docs.find(d => d.id === id).data();
        
        await addDoc(collection(db, "returns"), { ...orderData, returnDate: new Date() });
        await deleteDoc(doc(db, "orders", id));
        alert("ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª.");
        loadOrders();
    };

    loadOrders();
</script>
</body>
</html>

