<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #090979; --cyan: #00d4ff; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 5px solid var(--blue); }
        input, textarea, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { background: var(--blue); color: white; cursor: pointer; border: none; font-weight: bold; }
        .product-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 10px; }
    </style>
</head>
<body>
<div style="max-width: 800px; margin: auto;">
    <div class="card">
        <h3><i class="fas fa-folder-plus"></i> إضافة قسم جديد (مع صورة)</h3>
        <input type="text" id="catName" placeholder="اسم القسم (مثلاً: شواحن)">
        <input type="text" id="catImg" placeholder="رابط صورة القسم">
        <button onclick="saveCat()">حفظ القسم</button>
    </div>

    <div class="card">
        <h3><i class="fas fa-plus-circle"></i> إضافة منتج جديد</h3>
        <input type="text" id="pName" placeholder="اسم المنتج">
        <select id="pCatList"><option value="">اختر القسم...</option></select>
        <input type="number" id="pPrice" placeholder="السعر ($)">
        <input type="text" id="pImg" placeholder="رابط صورة المنتج">
        <textarea id="pDesc" placeholder="وصف المنتج التفصيلي..." rows="3"></textarea>
        <button onclick="saveProduct()">نشر المنتج</button>
    </div>

    <div class="card">
        <h3>المخزن الحالي</h3>
        <div id="inventory"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCnzm7b0mEiszDck9d_KvOfVMN2WguQs8w",
        authDomain: "o-cell-8bd7f.firebaseapp.com",
        projectId: "o-cell-8bd7f",
        storageBucket: "o-cell-8bd7f.firebasestorage.app",
        messagingSenderId: "123702658364",
        appId: "1:123702658364:web:f51ca179843af7bab24a39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveCat = async () => {
        await addDoc(collection(db, "categories"), { 
            name: document.getElementById('catName').value, 
            image: document.getElementById('catImg').value 
        });
        alert("تم حفظ القسم!"); location.reload();
    };

    async function init() {
        const cSnap = await getDocs(collection(db, "categories"));
        const sel = document.getElementById('pCatList');
        cSnap.forEach(d => sel.innerHTML += `<option value="${d.data().name}">${d.data().name}</option>`);
        loadInv();
    }

    window.saveProduct = async () => {
        await addDoc(collection(db, "products"), {
            name: document.getElementById('pName').value,
            category: document.getElementById('pCatList').value,
            price: document.getElementById('pPrice').value,
            image: document.getElementById('pImg').value,
            description: document.getElementById('pDesc').value,
            inStock: true
        });
        alert("تم النشر!"); loadInv();
    };

    window.loadInv = async () => {
        const pSnap = await getDocs(collection(db, "products"));
        const inv = document.getElementById('inventory');
        inv.innerHTML = "";
        pSnap.forEach(d => {
            const p = d.data();
            inv.innerHTML += `<div class="product-item"><span>${p.name} ($${p.price})</span> 
            <button onclick="delProd('${d.id}')" style="width:70px; background:red;">حذف</button></div>`;
        });
    };

    window.delProd = async (id) => { if(confirm("حذف؟")) { await deleteDoc(doc(db, "products", id)); loadInv(); } };
    init();
</script>
</body>
</html>
    window.delProd = async (id) => { if(confirm("حذف القطعة؟")) { await deleteDoc(doc(db, "products", id)); loadInv(); } };
    window.changeStock = async (id, s) => { await updateDoc(doc(db, "products", id), { inStock: !s }); loadInv(); };

    init();
</script>
</body>
</html>

